---
layout: post
title: "UICollectionViewTransitionLayout ì´ë€?"
author: "doremin"
tags: [iOS, UIKit, UICollectionView]
---

# UICollectionViewTransitionLayout ì´ë€?

> LINE iOS Appì„ ì‚´í´ë³´ë‹¤ê°€ ì´ë¯¸ì§€ í”¼ì»¤ì—ì„œ PinchGestureë¥¼ í†µí•´ Gridì˜ column ê°œìˆ˜ë¥¼ ì¡°ì ˆí•˜ëŠ” ë°©ì‹ì´ ì¸ìƒì ì–´ì„œ ì–´ë–»ê²Œ êµ¬í˜„í•  ìˆ˜ ìˆëŠ”ì§€ ì°¾ì•„ë³´ê²Œ ë˜ì—ˆì–´ìš”.

## 1. ì™œ í•„ìš”í•œê°€?

ë³´í†µ ë ˆì´ì•„ì›ƒì„ ë³€ê²½í•˜ë ¤ë©´ `setCollectionViewLayout`ì„ ì´ìš©í•©ë‹ˆë‹¤.

```swift
collectionView.setCollectionViewLayout(newLayout, animated: true)
```

í•˜ì§€ë§Œ ì´ ë°©ì‹ì€ "ì²˜ìŒ"ê³¼ "ë" ë‘ ì§€ì ë§Œ ì •ì˜í•  ìˆ˜ ìˆê³ , ì „í™˜ ê³¼ì •ì€ ì‹œìŠ¤í…œì´ ìë™ìœ¼ë¡œ ì²˜ë¦¬í•©ë‹ˆë‹¤.
ë”°ë¼ì„œ ì‚¬ìš©ìì˜ ì œìŠ¤ì²˜ì— ë”°ë¼ ì‹¤ì‹œê°„ìœ¼ë¡œ ë ˆì´ì•„ì›ƒ ì „í™˜ ìƒíƒœë¥¼ ì œì–´í•˜ëŠ” ê²ƒì€ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.

ì˜ˆë¥¼ ë“¤ì–´, ì‚¬ì§„ ê°¤ëŸ¬ë¦¬ì—ì„œ í•€ì¹˜ ì œìŠ¤ì²˜ë¥¼ í†µí•´ column ìˆ˜ë¥¼ ì ì°¨ ëŠ˜ë¦¬ê±°ë‚˜ ì¤„ì´ëŠ” UIë¥¼ êµ¬í˜„í•˜ë ¤ë©´,
ì‚¬ìš©ìì˜ ì†ê°€ë½ ì›€ì§ì„ì— ë”°ë¼ ë§¤ í”„ë ˆì„ë§ˆë‹¤ ë ˆì´ì•„ì›ƒ ìƒíƒœë¥¼ ë¯¸ì„¸í•˜ê²Œ ì¡°ì •í•  ìˆ˜ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.

ì´ëŸ° ìƒí™©ì—ì„œ UICollectionViewTransitionLayoutì´ ìœ ìš©í•˜ê²Œ ì‚¬ìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## 2. TransitionLayoutì´ë€?
UICollectionViewTransitionLayoutì€ ê¸°ì¡´ ë ˆì´ì•„ì›ƒê³¼ ìƒˆë¡œìš´ ë ˆì´ì•„ì›ƒ ì‚¬ì´ì˜ ì¤‘ê°„(interpolated) ìƒíƒœë¥¼ ë§Œë“¤ì–´ì£¼ëŠ” ë ˆì´ì•„ì›ƒì…ë‹ˆë‹¤.

ì¦‰, ê¸°ì¡´ layoutAì—ì„œ ìƒˆë¡œìš´ layoutBë¡œ ì „í™˜ë˜ëŠ” ê³¼ì •ì„ ì§ì ‘ progress ê°’ìœ¼ë¡œ ì œì–´í•  ìˆ˜ ìˆë„ë¡ ë„ì™€ì¤ë‹ˆë‹¤.



## 3. ì‚¬ìš©ë²•
```swift
// 1. ìƒˆë¡œìš´ ë ˆì´ì•„ì›ƒ ì¤€ë¹„
let newLayout = ZoomedLayout()

// 2. ì „í™˜ ì‹œì‘
let transitionLayout = collectionView.startInteractiveTransition(to: newLayout) {
    // ì „í™˜ ì™„ë£Œ ì‹œ í˜¸ì¶œë¨
}

// 3. ì œìŠ¤ì²˜ë¥¼ í†µí•´ ì „í™˜ ì§„í–‰ë„ ì—…ë°ì´íŠ¸
transitionLayout.transitionProgress = 0.3

// 4. ì „í™˜ ì™„ë£Œ ë˜ëŠ” ì·¨ì†Œ
collectionView.finishInteractiveTransition()
// ë˜ëŠ”
collectionView.cancelInteractiveTransition()
```

## 4. Pinch Gestureì™€ ì‚¬ìš©í•˜ê¸°

**ğŸ“ ì „ì²´ ì½”ë“œ: [GitHub](https://github.com/doremin/TransitionLayout)**

### ğŸ§  ë™ì‘ ê°œìš”

1. ì‚¬ìš©ìê°€ í•€ì¹˜í•˜ë©´ `scale` ê°’ì´ ë“¤ì–´ì˜µë‹ˆë‹¤ (`1`ë³´ë‹¤ í¬ë©´ í™•ëŒ€, ì‘ìœ¼ë©´ ì¶•ì†Œ).
2. `log2(scale)`ì„ í†µí•´ í™•ëŒ€/ì¶•ì†Œ ì •ë„ë¥¼ ì •ê·œí™”í•˜ê³  ë°©í–¥ì„ íŒë‹¨í•©ë‹ˆë‹¤.
3. ì´ ê°’ì„ ê¸°ë°˜ìœ¼ë¡œ ìƒˆ ë ˆì´ì•„ì›ƒì„ ì„ íƒí•˜ê³  ì „í™˜ì„ ì‹œì‘í•©ë‹ˆë‹¤.
4. ì œìŠ¤ì²˜ê°€ ì§„í–‰ë ìˆ˜ë¡ `transitionProgress`ë¥¼ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.
5. ì œìŠ¤ì²˜ê°€ ëë‚¬ì„ ë•Œ ì§„í–‰ë„ê°€ 50% ì´ìƒì´ë©´ ì „í™˜ ì™„ë£Œ, ì•„ë‹ˆë©´ ì·¨ì†Œí•©ë‹ˆë‹¤.


```swift
@objc private func handlePinch(_ gesture: UIPinchGestureRecognizer) {
    switch gesture.state {
    case .changed:
        handlePinchChanged(with: gesture.scale)

    case .ended, .cancelled:
        completeOrCancelTransition()

    default:
        break
    }
}

private func handlePinchChanged(with scale: CGFloat) {
    let logScale = log2(scale)

    if interactiveLayout == nil {
        guard let targetIndex = calculateTargetLayoutIndex(from: logScale) else { return }
        startInteractiveTransition(to: targetIndex)
    }

    interactiveLayout?.transitionProgress = calculateProgress(from: logScale)
}

private func startInteractiveTransition(to targetIndex: Int) {
    let targetLayout = layouts[targetIndex]

    interactiveLayout = collectionView.startInteractiveTransition(to: targetLayout) { [weak self] _, finished in
        guard let self = self else { return }
        if finished {
            self.currentLayoutIndex = targetIndex
        }
        self.interactiveLayout = nil
    }
}

private func completeOrCancelTransition() {
    guard let layout = interactiveLayout else { return }

    if layout.transitionProgress > 0.5 {
        collectionView.finishInteractiveTransition()
    } else {
        collectionView.cancelInteractiveTransition()
    }

    interactiveLayout = nil
}

```

## 5. LINE vs ìƒ˜í”Œ ì•± ë¹„êµ
**ë¼ì¸ iOS Application**
![line](/assets/images/2025-06-13/line.gif)

**TransitionLayout êµ¬í˜„ Sample App**
![sample](/assets/images/2025-06-13/sample.gif)

